---
- name: icinga is installed
  apt:
    name: icinga
    state: installed

- name: passlib is installed
  apt:
    name: python-passlib
    state: installed

- name: icinga users are present
  htpasswd:
    path: /etc/icinga/htpasswd.users
    name: "{{ item.username }}"
    password: "{{ item.password }}"
  with_items: "{{ icinga_users }}"

- name: Objects are present
  copy:
    src: "{{ item }}"
    dest: /etc/icinga/objects/
  with_fileglob:
    - "{{ icinga_objects_dir }}/*"
  notify: reload icinga

- name: service is enabled
  service:
    name: icinga
    enabled: true

- name: service is started
  service:
    name: icinga
    state: started
